<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>基板热脏污识别 · 虹小聊</title>
<link rel="stylesheet" href="styles/app.css">
</head>
<body data-page="vision">
<div class="app-shell">
  <aside class="sidebar" id="bankSidebar">
    <div class="brand"><img class="brand-logo" src="assets/logo.png" alt="虹小聊 logo"><span class="brand-name">虹小聊</span></div>
    <div class="nav-group">
      <a class="nav-link" href="index.html">对话</a>
      <a class="nav-link" href="kb.html">知识库</a>
      <a class="nav-link" href="favorites.html">收藏夹</a>
      <a class="nav-link" href="decision.html">决策链</a>
      <a class="nav-link" href="ai-tools.html">AI 工具箱</a>
      <a class="nav-link" href="admin.html">系统</a>
    </div>
    <div class="sidebar-section">
      <div class="section-title">记忆库</div>
      <div class="badge-list" id="bankList"></div>
      <button class="ghost-button" id="createBank">新建记忆库</button>
    </div>
    <a class="ghost-button toolbox-link" href="ai-tools.html">返回工具箱</a>
    <button class="ghost-button" id="logoutButton">退出登录</button>
  </aside>
  <main class="main-panel vision-main">
    <header class="main-header">
      <div class="header-info">
        <div class="header-title">基板热脏污识别工作台</div>
        <div class="header-sub">粘贴或上传检测图，自动识别热脏污主体区域并支持人工订正、导出与强化学习。</div>
      </div>
      <div class="user-info" id="userInfo"></div>
    </header>
    <section class="panel vision-workbench">
      <div class="vision-workbench-grid">
        <div class="vision-stage">
          <div class="vision-stage-toolbar" id="visionToolbar">
            <button type="button" class="ghost-button" data-tool="select" aria-pressed="true">选择</button>
            <button type="button" class="ghost-button" data-tool="brush">画笔</button>
            <button type="button" class="ghost-button" data-tool="text">文本</button>
            <button type="button" class="ghost-button" data-tool="magnify">放大镜</button>
            <button type="button" class="ghost-button" id="visionUndoBtn" data-tool="undo" disabled aria-disabled="true">撤回</button>
          </div>
          <div class="vision-tool-options" id="visionToolOptions" style="display:none;">
            <div class="vision-tool-panel" id="visionBrushOptions" aria-label="画笔设置">
              <div class="vision-option-group">
                <span class="vision-option-label">笔宽</span>
                <button type="button" class="vision-chip-option" data-brush-width="3">细</button>
                <button type="button" class="vision-chip-option" data-brush-width="6">中</button>
                <button type="button" class="vision-chip-option" data-brush-width="10">粗</button>
              </div>
              <div class="vision-option-group">
                <span class="vision-option-label">颜色</span>
                <button type="button" class="vision-chip-option" data-brush-color="#fa541c" style="--chip-color:#fa541c">暖橙</button>
                <button type="button" class="vision-chip-option" data-brush-color="#2563eb" style="--chip-color:#2563eb">冷蓝</button>
                <button type="button" class="vision-chip-option" data-brush-color="#16a34a" style="--chip-color:#16a34a">安全绿</button>
              </div>
            </div>
            <div class="vision-tool-panel" id="visionTextOptions" aria-live="polite">
              <div class="vision-option-note">单击画布放置文本框，拖动标题可移动位置，输入内容后自动保存并可通过撤回恢复。</div>
            </div>
          </div>
          <div class="vision-upload" id="visionUpload" tabindex="0">
            <div class="vision-placeholder" id="visionPlaceholder">
              <strong>粘贴 (Ctrl+V)</strong> 或拖放玻璃检测图到此处
              <span>支持 PNG / JPG / WEBP，导入后可圈选主体区域并订正分类。</span>
            </div>
            <canvas id="visionCanvas" class="vision-canvas hidden" aria-label="热脏污识别画布"></canvas>
            <canvas id="visionSketch" class="vision-sketch hidden" aria-hidden="true"></canvas>
            <div id="visionOverlay" class="vision-overlay hidden"></div>
            <div id="visionSelection" class="vision-selection hidden"></div>
            <div id="visionAnnotations" class="vision-annotations hidden" aria-live="polite"></div>
            <div id="visionMagnifier" class="vision-magnifier hidden" aria-hidden="true">
              <canvas id="visionMagnifierCanvas"></canvas>
            </div>
          </div>
          <div class="vision-stage-footer">
            <div class="vision-stage-actions">
              <button type="button" class="ghost-button" id="visionUploadBtn">选择文件</button>
              <input type="file" id="visionFileInput" accept="image/png,image/jpeg,image/jpg,image/webp" class="hidden">
              <button type="button" class="ghost-button" id="visionExportBtn" disabled>导出带标注</button>
            </div>
            <div class="vision-hint">系统仅记录识别时间与类别，概率及订正会进入强化学习反馈。</div>
          </div>
        </div>
        <aside class="vision-side">
          <div class="vision-side-header">
            <div class="vision-side-title">识别结果</div>
            <div class="vision-side-tools">
              <button type="button" class="ghost-button" id="visionAddFindingBtn">新增主体</button>
              <a class="ghost-button" id="visionHistoryToggle" href="ai-vision-history.html">历史中心</a>
            </div>
          </div>
          <div class="vision-summary" id="visionSummary">
            <div class="vision-summary-status">待命</div>
            <div class="vision-summary-meta">等待图像输入</div>
          </div>
          <div id="visionFindings" class="vision-findings"></div>
          <form id="visionNoteForm" class="vision-note-form hidden">
            <label for="visionNoteInput">识别备注</label>
            <textarea id="visionNoteInput" placeholder="记录这次识别的工单、设备或处理意见"></textarea>
            <div class="vision-note-actions">
              <button type="submit" class="primary-button">保存备注</button>
            </div>
          </form>
        </aside>
      </div>
    </section>
  </main>
</div>
<script src="scripts/app.js"></script>
<script src="scripts/tools-vision.js"></script>
</body>
</html>
