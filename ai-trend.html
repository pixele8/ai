<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>趋势分析预测系统 · 虹小聊</title>
<link rel="stylesheet" href="styles/app.css">
</head>
<body data-page="trend">
<div class="app-shell">
  <aside class="sidebar" id="bankSidebar">
    <div class="brand"><img class="brand-logo" src="assets/logo.png" alt="虹小聊 logo"><span class="brand-name">虹小聊</span></div>
    <div class="nav-group">
      <a class="nav-link" href="index.html">对话</a>
      <a class="nav-link" href="kb.html">知识库</a>
      <a class="nav-link" href="favorites.html">收藏夹</a>
      <a class="nav-link" href="decision.html">决策链</a>
      <a class="nav-link active" href="ai-tools.html">AI 工具箱</a>
      <a class="nav-link" href="admin.html">系统</a>
    </div>
    <div class="sidebar-section">
      <div class="section-title">记忆库</div>
      <div class="badge-list" id="bankList"></div>
      <button class="ghost-button" id="createBank">新建记忆库</button>
    </div>
    <a class="ghost-button toolbox-link" href="ai-tools.html">返回工具箱</a>
    <button class="ghost-button" id="logoutButton">退出登录</button>
  </aside>
  <main class="main-panel trend-main">
    <header class="main-header">
      <div class="header-info">
        <div class="header-title">趋势分析预测系统</div>
        <div class="header-sub">定义监测节点、实时生成趋势预测并采集人工订正，预留 MES 数据接入接口。</div>
      </div>
      <div class="user-info" id="userInfo"></div>
    </header>
    <section class="panel trend-panel">
      <div class="trend-grid">
        <aside class="trend-config" aria-label="节点组配置">
          <div class="trend-config-header">
            <h2>节点组拓扑</h2>
            <button type="button" class="ghost-button" id="trendAddNode">新增节点组</button>
          </div>
          <div class="trend-config-body" id="trendNodeList" role="tree"></div>
          <form id="trendNodeForm" class="trend-form" autocomplete="off">
            <h3 id="trendFormTitle">节点组详情</h3>
            <div class="form-field">
              <label for="trendNodeKey">唯一标识</label>
              <input id="trendNodeKey" name="key" type="text" placeholder="如：cooling-section" required>
              <p class="form-hint">用于计算与追踪的唯一 ID，可自定义且在全局内保持唯一。</p>
            </div>
            <div class="form-field">
              <label for="trendNodeName">名称</label>
              <input id="trendNodeName" name="name" type="text" placeholder="如：降温段温度" required>
            </div>
            <div class="form-field">
              <label for="trendNodeNote">备注</label>
              <textarea id="trendNodeNote" name="note" rows="2" placeholder="记录该节点组的说明或所含节点"></textarea>
            </div>
            <div class="form-field">
              <label for="trendNodeParent">所属节点组</label>
              <select id="trendNodeParent" name="parent">
                <option value="">顶层节点组</option>
              </select>
              <p class="form-hint">可选上级节点组，支持多层嵌套结构。</p>
            </div>
            <div class="form-row triple">
              <div class="form-field">
                <label for="trendNodeUnit">单位</label>
                <input id="trendNodeUnit" name="unit" type="text" placeholder="℃ / A / % 等">
              </div>
              <div class="form-field">
                <label for="trendNodeManual">手动调整节点</label>
                <select id="trendNodeManual" name="manual">
                  <option value="false">否</option>
                  <option value="true">是</option>
                </select>
              </div>
              <div class="form-field">
                <label for="trendNodeSimulation">演示模拟</label>
                <select id="trendNodeSimulation" name="simulate">
                  <option value="true">启用</option>
                  <option value="false">停用</option>
                </select>
              </div>
            </div>
            <div class="form-row triple">
              <div class="form-field">
                <label for="trendNodeLower">下限</label>
                <input id="trendNodeLower" name="lower" type="number" step="any" placeholder="可选">
              </div>
              <div class="form-field">
                <label for="trendNodeCenter">中值</label>
                <input id="trendNodeCenter" name="center" type="number" step="any" placeholder="可选">
              </div>
              <div class="form-field">
                <label for="trendNodeUpper">上限</label>
                <input id="trendNodeUpper" name="upper" type="number" step="any" placeholder="可选">
              </div>
            </div>
            <div class="form-field">
              <label for="trendNodePosition">相对位置</label>
              <select id="trendNodePosition" name="positionMode">
                <option value="after">位于前一节点之后</option>
                <option value="parallel">与前一节点并行</option>
                <option value="same">与前一节点同位置</option>
              </select>
            </div>
            <div class="form-field" id="trendNodeRefField" hidden>
              <label for="trendNodeRef">参考节点</label>
              <select id="trendNodeRef" name="positionRef"></select>
            </div>
            <div class="form-field" id="trendManualStepField" hidden>
              <label for="trendManualStep">单次标准调整量</label>
              <input id="trendManualStep" name="manualStep" type="number" step="any" placeholder="如：0.5">
            </div>
            <div class="form-field" id="trendManualImpactField" hidden>
              <label for="trendManualImpact">受影响节点</label>
              <select id="trendManualImpact" name="manualImpact" multiple size="4"></select>
              <p class="form-hint">选择该手动节点会直接影响的监测节点，用于预测关联分析。</p>
            </div>
            <div class="trend-subnodes">
              <div class="trend-subnodes-header">
                <h4>节点列表</h4>
                <button type="button" class="ghost-button" id="trendAddSubNode">新增节点</button>
              </div>
              <div id="trendSubNodeList" role="list"></div>
            </div>
            <div class="form-actions">
              <button type="submit" class="primary-button">保存节点组</button>
              <button type="button" class="ghost-button danger" id="trendDeleteNode">删除节点组</button>
            </div>
          </form>
          <div class="trend-config-footer">
            <h3>演示模式</h3>
            <div class="trend-demo-controls">
              <button type="button" class="primary-button" id="trendStartDemo">启动演示</button>
              <button type="button" class="ghost-button" id="trendStopDemo">停止</button>
              <button type="button" class="ghost-button" id="trendManualAdjust">记录手动调整</button>
            </div>
            <div class="trend-demo-info" id="trendDemoStatus">演示模式未开启。</div>
            <div class="trend-mes-hint">预留 REST / WebSocket / 数据库 接口：可在右侧设置中注册 MES 数据源。</div>
          </div>
        </aside>
        <section class="trend-stage" aria-label="趋势监控">
          <div class="trend-stage-top">
            <div class="trend-metrics" id="trendSummary"></div>
            <div class="trend-target-card" id="trendOutputCard">
              <div class="trend-target-title">引出量中心</div>
              <div class="trend-target-values">
                <span class="trend-target-center" id="trendTargetCenter">--</span>
                <span class="trend-target-range" id="trendTargetRange">上下限 -- / --</span>
              </div>
            </div>
          </div>
          <div class="trend-chart-wrapper">
            <canvas id="trendChart" aria-label="趋势曲线"></canvas>
            <div class="trend-chart-toolbar">
              <button type="button" class="ghost-button" data-range="60">近 1 小时</button>
              <button type="button" class="ghost-button" data-range="180">近 3 小时</button>
              <button type="button" class="ghost-button" data-range="720">近 12 小时</button>
              <button type="button" class="ghost-button" id="trendExportCsv">导出数据</button>
            </div>
          </div>
          <div class="trend-matrix" id="trendMatrix">
            <div class="trend-matrix-header">
              <h2>节点实时矩阵</h2>
              <p class="trend-matrix-hint">聚合展示所有节点的最新读数、状态与微型曲线，便于全局监控。</p>
            </div>
            <div class="trend-matrix-grid" id="trendMatrixGrid" role="list"></div>
          </div>
          <div class="trend-library" id="trendLibrary">
            <div class="trend-library-header">
              <h2>节点库</h2>
              <p class="trend-library-hint">节点与节点组在此独立存档，展示嵌套路径与上下限，为后续 MES 接入及关联分析提供基础。</p>
            </div>
            <div class="trend-library-list" id="trendLibraryList"></div>
          </div>
          <div class="trend-forecast" id="trendForecast">
            <div class="trend-forecast-header">
              <h2>预测展望</h2>
              <button type="button" class="ghost-button" id="trendRefreshForecast">刷新预测</button>
            </div>
            <div class="trend-forecast-list" id="trendForecastList"></div>
          </div>
          <div class="trend-advice" id="trendAdvice">
            <div class="trend-advice-header">
              <h2>实时建议</h2>
              <div class="trend-advice-tools">
                <button type="button" class="ghost-button" id="trendRefreshAdvice">刷新</button>
                <button type="button" class="ghost-button" id="trendOpenHistory">历史记录</button>
              </div>
            </div>
            <div class="trend-advice-list" id="trendAdviceList"></div>
          </div>
          <div class="trend-scenario" id="trendScenario">
            <div class="trend-scenario-header">
              <div>
                <h2>情景模拟</h2>
                <p>组合节点调整、推演趋势并保存为长期方案。</p>
              </div>
              <div class="trend-scenario-header-actions">
                <label class="trend-scenario-save">
                  <input type="checkbox" id="trendScenarioPersist">
                  <span>保存并写入历史</span>
                </label>
                <button type="button" class="primary-button" id="trendScenarioRun">运行模拟</button>
              </div>
            </div>
            <form id="trendScenarioForm" class="trend-scenario-form" autocomplete="off">
              <div class="form-row dual">
                <div class="form-field">
                  <label for="trendScenarioName">方案名称</label>
                  <input id="trendScenarioName" type="text" placeholder="如：降温段调优演练">
                </div>
                <div class="form-field">
                  <label for="trendScenarioHorizon">预测前瞻 (分钟)</label>
                  <input id="trendScenarioHorizon" type="number" min="1" step="1">
                </div>
              </div>
              <div class="form-field">
                <label for="trendScenarioNote">备注</label>
                <textarea id="trendScenarioNote" rows="2" placeholder="说明假设条件或目标"></textarea>
              </div>
              <div class="trend-scenario-adjustments" id="trendScenarioAdjustments" role="list"></div>
              <div class="trend-scenario-actions">
                <button type="button" class="ghost-button" id="trendScenarioAddAdjustment">新增节点调整</button>
              </div>
            </form>
            <div class="trend-scenario-output" id="trendScenarioResult"></div>
            <div class="trend-scenario-saved">
              <h3>已保存的模拟</h3>
              <div class="trend-scenario-saved-list" id="trendScenarioSavedList"></div>
            </div>
          </div>
        </section>
        <aside class="trend-side" aria-label="模型设置">
          <div class="trend-side-block">
            <h3>预测设置</h3>
            <form id="trendSettingsForm">
              <div class="form-field">
                <label for="trendSampleInterval">采样周期 (ms)</label>
                <input id="trendSampleInterval" name="sampleIntervalMs" type="number" step="100">
              </div>
              <div class="form-field">
                <label for="trendLookback">分析窗口 (分钟)</label>
                <input id="trendLookback" name="lookbackMinutes" type="number">
              </div>
              <div class="form-field">
                <label for="trendPrediction">预测前瞻 (分钟)</label>
                <input id="trendPrediction" name="predictionMinutes" type="number">
              </div>
              <div class="form-field">
                <label>引出量目标</label>
                <div class="trend-target-grid">
                  <input id="trendTargetCenterInput" name="outputCenter" type="number" step="any" placeholder="中心值">
                  <input id="trendTargetLowerInput" name="outputLower" type="number" step="any" placeholder="下限">
                  <input id="trendTargetUpperInput" name="outputUpper" type="number" step="any" placeholder="上限">
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="primary-button">保存设置</button>
              </div>
            </form>
          </div>
          <div class="trend-side-block">
            <h3>MES 数据接口</h3>
            <div id="trendEndpointList" class="trend-endpoint-list"></div>
            <button type="button" class="ghost-button" id="trendAddEndpoint">注册数据源</button>
          </div>
          <div class="trend-side-block">
            <h3>人工反馈</h3>
            <form id="trendFeedbackForm">
              <div class="form-field">
                <label for="trendFeedbackSuggestion">关联建议</label>
                <select id="trendFeedbackSuggestion"></select>
              </div>
              <div class="form-field">
                <label for="trendFeedbackRating">评分 (1-5)</label>
                <input id="trendFeedbackRating" type="number" min="1" max="5">
              </div>
              <div class="form-field">
                <label for="trendFeedbackNote">人工订正</label>
                <textarea id="trendFeedbackNote" rows="3" placeholder="说明正确流程或标准操作"></textarea>
              </div>
              <div class="form-actions">
                <button type="submit" class="primary-button">提交反馈</button>
              </div>
            </form>
          </div>
        </aside>
      </div>
    </section>
  </main>
</div>
<script src="scripts/app.js"></script>
<script src="scripts/tools-trend.js"></script>
</body>
</html>
